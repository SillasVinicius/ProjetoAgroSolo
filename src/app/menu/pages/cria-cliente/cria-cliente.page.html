<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/menu"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ pageTitle }}</ion-title>
    <app-logout-button
      slot="end"
      menu="main-menu"
    ></app-logout-button>
  </ion-toolbar>
</ion-header>

<ion-content padding>
  <form
    [formGroup]="clienteForm"
    (submit)="onSubmit()"
    novalidate
  >
    <ion-item>
      <ion-icon
        slot="start"
        name="person"
        color="primary"
      ></ion-icon>
      <ion-input
        formControlName="nome"
        type="text"
        placeholder="Nome"
        color="primary"
        autoFocus="true"
      ></ion-input>
      <ion-note
        slot="end"
        color="danger"
        *ngIf="nome.dirty && nome.hasError('required')"
      >
        Nome Obrigatório!
      </ion-note>
      <ion-note
        slot="end"
        color="danger"
        *ngIf="nome.dirty && nome.hasError('minlength')"
      >
        Mínimo 3 caracteres
      </ion-note>
    </ion-item>
    <ion-item>
      <ion-icon
        slot="start"
        name="key"
        color="primary"
      ></ion-icon>
      <ion-input
        formControlName="cpf"
        placeholder="Cpf"
        color="primary"
      ></ion-input>
      <ion-note
        slot="end"
        color="danger"
        *ngIf="cpf.dirty && cpf.hasError('required')"
      >
        Cpf Obrigatório!
      </ion-note>
      <ion-note
        slot="end"
        color="danger"
        *ngIf="cpf.dirty && (cpf.hasError('minlength') || cpf.hasError('maxlength'))"
      >
        Cpf Inválido!
      </ion-note>
    </ion-item>
    <ion-item>
      <ion-icon
        slot="start"
        name="logo-usd"
        color="primary"
      ></ion-icon>
      <ion-input
        formControlName="patrimonio"
        placeholder="Patrimônio"
        color="primary"
      ></ion-input>
      <ion-note
        slot="end"
        color="danger"
        *ngIf="patrimonio.dirty && patrimonio.hasError('required')"
      >
        Patrimônio Obrigatório!
      </ion-note>
      <ion-note
        slot="end"
        color="danger"
        *ngIf="
          patrimonio.dirty && (patrimonio.hasError('minlength') || patrimonio.hasError('maxlength'))
        "
      >
        Patrimônio Inválido!
      </ion-note>
    </ion-item>
    <ion-item>
      <ion-icon
        slot="start"
        name="cash"
        color="primary"
      ></ion-icon>
      <ion-input
        formControlName="pdtvAgro"
        placeholder="Produtividade Agropecuária"
        color="primary"
      ></ion-input>
      <ion-note
        slot="end"
        color="danger"
        *ngIf="pdtvAgro.dirty && pdtvAgro.hasError('required')"
      >
        Prod.Agropecuária Obrigatória!
      </ion-note>
      <ion-note
        slot="end"
        color="danger"
        *ngIf="pdtvAgro.dirty && (pdtvAgro.hasError('minlength') || pdtvAgro.hasError('maxlength'))"
      >
        Prod.Agropecuária Inválida!
      </ion-note>
    </ion-item>
    <ion-card
      text-center
      *ngIf="!isUploading && !isUploaded"
    >
      <ion-card-header>
        <ion-card-title style="font-size: 20px;">Adicione uma Foto</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="fileUpload">
          <label
            for="uploadBtn"
            *ngIf="clienteForm.valid"
          >
            Adicionar
          </label>
          <ion-button
            *ngIf="!clienteForm.valid"
            [disabled]="true"
            expand="full"
            style="margin-top: -4%; margin-bottom: -2%;"
          >
            Desabilitado
          </ion-button>
          <input
            id="uploadBtn"
            type="file"
            class="upload"
            (change)="uploadFile($event.target.files)"
          >
        </div>
      </ion-card-content>
    </ion-card>
    <ion-card
      text-center
      *ngIf="isUploading && !isUploaded"
    >
      <ion-card-header>
        <ion-card-title>
          Selected File:
          <b>{{ fileName }}</b>
        </ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <div *ngIf="percentage | async as pct">
          Progress: {{ pct | number }}%
          <ion-progress-bar value="{{ pct / 100 }}"></ion-progress-bar>
        </div>
        <div *ngIf="snapshot | async as snap">
          File Size: {{ snap.totalBytes | fileSizePipe }} Transfered:
          {{ snap.bytesTransferred | fileSizePipe }}
          <div *ngIf="snapshot && snap.bytesTransferred != snap.totalBytes">
            <ion-button
              color="warning"
              size="small"
              (click)="task.pause()"
              class="button is-warning"
            >
              Pause
            </ion-button>
            <ion-button
              size="small"
              (click)="task.resume()"
              class="button is-info"
            >
              Resume
            </ion-button>
            <ion-button
              color="danger"
              size="small"
              (click)="task.cancel()"
              class="button is-danger"
            >
              Cancel
            </ion-button>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
    <ion-card
      text-center
      *ngIf="!isUploading && isUploaded"
    >
      <ion-card-header>
        <ion-card-title style="font-size: 20px;">Imagem Adicionada!</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <div *ngIf="UploadedFileURL | async as url">
          <img [src]="url">
        </div>
        File Size: {{ fileSize | fileSizePipe }}
      </ion-card-content>
    </ion-card>
    <app-uploader></app-uploader>
    <!-- <ion-item lines="none">
      <ion-card *ngFor="let file of files | async">
        <ion-card-header>{{ file.created | date:'medium' }}</ion-card-header>

        <ion-card-content>

          <button
            ion-button
            block
            icon-left
            outline
            (click)="viewFile(file.url)"
          >
            <ion-icon name="eye"></ion-icon>
            {{ file.fullPath }}
          </button>

          <button
            ion-button
            block
            outline
            icon-left
            color="danger"
            (click)="deleteFile(file)"
          >
            <ion-icon name="trash"></ion-icon>
            Delete
          </button>

        </ion-card-content>

      </ion-card>

      <ion-fab
        right
        bottom
      >
        <button
          ion-fab
          color="primary"
          (click)="addFile()"
        >
          <ion-icon name="cloud-upload"></ion-icon>
        </button>
      </ion-fab>

    </ion-item> -->
    <ion-button
      expand="full"
      type="submit"
      *ngIf="fileName !== ''"
      [disabled]="clienteForm.invalid"
    >
      {{ botaoTitle }}
    </ion-button>
    <ion-button
      expand="full"
      *ngIf="fileName === ''"
      [disabled]="true"
    >
      DESABILITADO
    </ion-button>
  </form>
</ion-content>
